aa = <<~END
  00000000000111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00000001111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00000111111111111111111100000000000001111111111111111100011111100000000000000000000000000000000000011111000000000000000000000
  00011111110000000001111111000000000001111111111111111100011111100000000000000000000000000000000000011111000000000000000000000
  00111111000000000000011111100000000001111110000000000000000000000001110000000000000000000000000000111111000111100000000111000
  00111110011110000000000111110000000001111110000000000000011111100001111111111111110000000111111111111111000111111000001111110
  01111111111100000000000111110000000001111110000000000000011111100001111111111111111100001111111111111111000011111000011111100
  01111111111000000000000011110000000001111111111111110000011111100001111110000011111100011111110000111111000011111100111111000
  01111111000000000000000111110000000001111111111111110000011111100001111100000011111100011111000000011111000001111111111110000
  00111110000000000000000111110000000001111111111111110000011111100001111100000001111100011111000000011111000000111111111100000
  00111111000000000000011111100000000001111110000000000000011111100001111100000001111100011111100000111111000000011111111000000
  00011111111000000011111111000000000001111110000000000000011111100001111100000001111100001111111111111111000000001111110000000
  00000111111111111111111111110000000001111110000000000000011111100001111100000001111100000111111111111111000000001111100000000
  00000000111111111111100011111000000001111110000000000000011111100001111100000001111100000000111111001111000000011111100000000
  00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000
END

blue = <<~END
  00000000000111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00000001111111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00000111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00011111110000000001110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00111110011110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  01111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  01111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  01111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00011111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00000111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
  00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
END

blank_color = 0

start_text = 'eval$s=%w'
end_text = '.join'

aa_data = aa.split("\n")
x_length = aa_data.first.length
y_length = aa_data.length
last_point = aa_data.last.split('1').last.length # 最終行に1がないパターンは考慮しない

bits = aa.gsub("\n", '').reverse.to_i(2)
blue_bits = blue.gsub("\n", '').reverse.to_i(2)

bin = [Marshal.dump(bits)].pack('m').gsub("\n", '')
blue_bin = [Marshal.dump(blue_bits)].pack('m').gsub("\n", '')

code = <<~CODE
  n=Marshal.load("#{bin}".unpack("m")[0])
  c=Marshal.load("#{blue_bin}".unpack("m")[0])
  e="#{start_text}"<<#{"'".ord}<<($s*3)
  o=""
  j=-1

  0.upto(#{y_length}*#{x_length}-1){|i|
    ct=((c[i]==1)?"34":"#{blank_color}")
    o<<"\e["<<ct<<"m"
    o<<((n[i]==1)?e[j+=1]:#{' '.ord})
    o<<((i%#{x_length}==(#{x_length - 1}))?#{"\n".ord}:"")
    o<<"\e[0m"
  }
  o[-#{last_point + end_text.length + 1},6]=""<<#{"'".ord}<<"#{end_text}"
  puts(o)
CODE

code = code.split("\n").join(';')
code << '#'

file = File.new('quine_base.rb', 'w')
file.puts "#{start_text}'#{code}'#{end_text}"
